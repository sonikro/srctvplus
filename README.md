⚠️ **WARNING: AI-GENERATED CODE** ⚠️
=====================================

**DO NOT USE THIS FORK FOR PRODUCTION**

This repository contains **AI-generated code** that was created as an experimental attempt to fix 64-bit compatibility issues. The code has not been thoroughly tested or reviewed by experienced developers.

**Issues with this fork:**
- All modifications were generated by AI with minimal human verification
- The trampoline-based function hooking mechanism is experimental and untested in production
- The code may have security vulnerabilities or stability issues
- No guarantee of functionality on live servers

---

SrcTV+
======

Makes SrcTV send everything. For Team Fortress 2. Adds a small amount of extra
network traffic.

Installation
------------

Copy `srctvplus.so`(Linux) or `srctvplus.dll`(Windows) along with `srctvplus.vdf`
into `<TF2>/tf/custom/srctvplus/addons/` or `<TF2>/tf/addons/`.

### Multi-architecture support

The build script now creates architecture-specific binaries:
- `srctvplus_i486.so` - 32-bit version for legacy 32-bit servers
- `srctvplus_x86_64.so` - 64-bit version for modern 64-bit servers

After building, the script creates a `srctvplus.so` symlink pointing to the appropriate version.
For servers with only one architecture available, simply copy `srctvplus.so` to your server.

If both are built and you need to switch architectures, use:
```
ln -sf srctvplus_i486.so srctvplus.so     # For 32-bit servers
ln -sf srctvplus_x86_64.so srctvplus.so   # For 64-bit servers
```

### Network traffic usage

The plugin works by having the game server send the SrcTV clients more data,
and therefore the default `tv_maxrate 8000` may not be enough in all cases.
This is especially true at high `tv_snapshotrate`. It's therefore recommended
to set at least `tv_maxrate 20000` or if possible, `tv_maxrate 0`.

Compiling
---------

### Linux (32-bit and 64-bit):

**Prerequisites:**
- GCC with 32-bit and 64-bit support

**Build steps:**
```bash
# Initialize submodules (includes Capstone for 64-bit builds)
git submodule update --init --recursive

# Build Capstone
cd vendor/capstone
make
cd ../..

# Build the plugin
./build.sh
```

This will build both `srctvplus_i486.so` (32-bit) and `srctvplus_x86_64.so` (64-bit).

**Note:** The 64-bit version uses Capstone for proper RIP-relative instruction relocation in function hooks.

### Windows:
Open srctvplus.sln in Visual Studio 2017. Select 'Release' configuration.
Press `F6` to build. Resulting file will be in `Release/srctvplus.dll`.

Note that building requires the Visual Studio 2013 Build Tools(v120).
This is included in 
[Visual Studio 2013 Community Edition](https://go.microsoft.com/fwlink/?LinkId=532495&clcid=0x409).

Credits
-------

  - FunctionRoute (from TFTrue): Didrole
  - Capstone disassembler: Nguyen Anh Quynh
  - Source SDK: By Valve. Packaged by AlliedModders.
